/*! firstrally-api 05-03-2015 */
"use strict";!function(a){function b(a,b,c){var l=0,m=[0],n="",o=null,n=c||"UTF8";if("UTF8"!==n&&"UTF16BE"!==n&&"UTF16LE"!==n)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===b){if(0!==a.length%2)throw"srcString of HEX type must be in byte increments";o=e(a),l=o.binLen,m=o.value}else if("TEXT"===b)o=d(a,n),l=o.binLen,m=o.value;else if("B64"===b)o=g(a),l=o.binLen,m=o.value;else{if("BYTES"!==b)throw"inputFormat must be HEX, TEXT, B64, or BYTES";o=f(a),l=o.binLen,m=o.value}this.getHash=function(a,b,c,d){var e,f=null,g=m.slice(),n=l;if(3===arguments.length?"number"!=typeof c&&(d=c,c=1):2===arguments.length&&(c=1),c!==parseInt(c,10)||1>c)throw"numRounds must a integer >= 1";switch(b){case"HEX":f=h;break;case"B64":f=i;break;case"BYTES":f=j;break;default:throw"format must be HEX, B64, or BYTES"}if("SHA-384"===a)for(e=0;c>e;e+=1)g=w(g,n,a),n=384;else{if("SHA-512"!==a)throw"Chosen SHA variant is not supported";for(e=0;c>e;e+=1)g=w(g,n,a),n=512}return f(g,k(d))},this.getHMAC=function(a,b,c,o,p){var q,r,s,t,u=[],v=[];switch(q=null,o){case"HEX":o=h;break;case"B64":o=i;break;case"BYTES":o=j;break;default:throw"outputFormat must be HEX, B64, or BYTES"}if("SHA-384"===c)r=128,t=384;else{if("SHA-512"!==c)throw"Chosen SHA variant is not supported";r=128,t=512}if("HEX"===b)q=e(a),s=q.binLen,q=q.value;else if("TEXT"===b)q=d(a,n),s=q.binLen,q=q.value;else if("B64"===b)q=g(a),s=q.binLen,q=q.value;else{if("BYTES"!==b)throw"inputFormat must be HEX, TEXT, B64, or BYTES";q=f(a),s=q.binLen,q=q.value}if(a=8*r,b=r/4-1,s/8>r){for(q=w(q,s,c);q.length<=b;)q.push(0);q[b]&=4294967040}else if(r>s/8){for(;q.length<=b;)q.push(0);q[b]&=4294967040}for(r=0;b>=r;r+=1)u[r]=909522486^q[r],v[r]=1549556828^q[r];return c=w(v.concat(w(u.concat(m),a+l,c)),a+t,c),o(c,k(p))}}function c(a,b){this.a=a,this.b=b}function d(a,b){var c,d,e,f,g=[],h=[],i=0;if("UTF8"===b)for(d=0;d<a.length;d+=1)for(c=a.charCodeAt(d),h=[],128>c?h.push(c):2048>c?(h.push(192|c>>>6),h.push(128|63&c)):55296>c||c>=57344?h.push(224|c>>>12,128|c>>>6&63,128|63&c):(d+=1,c=65536+((1023&c)<<10|1023&a.charCodeAt(d)),h.push(240|c>>>18,128|c>>>12&63,128|c>>>6&63,128|63&c)),e=0;e<h.length;e+=1){for(f=i>>>2;g.length<=f;)g.push(0);g[f]|=h[e]<<24-i%4*8,i+=1}else if("UTF16BE"===b||"UTF16LE"===b)for(d=0;d<a.length;d+=1){for(c=a.charCodeAt(d),"UTF16LE"===b&&(e=255&c,c=e<<8|c>>8),f=i>>>2;g.length<=f;)g.push(0);g[f]|=c<<16-i%4*8,i+=2}return{value:g,binLen:8*i}}function e(a){var b,c,d,e=[],f=a.length;if(0!==f%2)throw"String of HEX type must be in byte increments";for(b=0;f>b;b+=2){if(c=parseInt(a.substr(b,2),16),isNaN(c))throw"String of HEX type contains invalid characters";for(d=b>>>3;e.length<=d;)e.push(0);e[b>>>3]|=c<<24-b%8*4}return{value:e,binLen:4*f}}function f(a){var b,c,d,e=[];for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),d=c>>>2,e.length<=d&&e.push(0),e[d]|=b<<24-c%4*8;return{value:e,binLen:8*a.length}}function g(a){var b,c,d,e,f,g=[],h=0;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(c=a.indexOf("="),a=a.replace(/\=/g,""),-1!==c&&c<a.length)throw"Invalid '=' found in base-64 string";for(c=0;c<a.length;c+=4){for(f=a.substr(c,4),d=e=0;d<f.length;d+=1)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d]),e|=b<<18-6*d;for(d=0;d<f.length-1;d+=1){for(b=h>>>2;g.length<=b;)g.push(0);g[b]|=(e>>>16-8*d&255)<<24-h%4*8,h+=1}}return{value:g,binLen:8*h}}function h(a,b){var c,d,e="",f=4*a.length;for(c=0;f>c;c+=1)d=a[c>>>2]>>>8*(3-c%4),e+="0123456789abcdef".charAt(d>>>4&15)+"0123456789abcdef".charAt(15&d);return b.outputUpper?e.toUpperCase():e}function i(a,b){var c,d,e,f="",g=4*a.length;for(c=0;g>c;c+=3)for(e=c+1>>>2,d=a.length<=e?0:a[e],e=c+2>>>2,e=a.length<=e?0:a[e],e=(a[c>>>2]>>>8*(3-c%4)&255)<<16|(d>>>8*(3-(c+1)%4)&255)<<8|e>>>8*(3-(c+2)%4)&255,d=0;4>d;d+=1)f=8*c+6*d<=32*a.length?f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-d)&63):f+b.b64Pad;return f}function j(a){var b,c,d="",e=4*a.length;for(b=0;e>b;b+=1)c=a[b>>>2]>>>8*(3-b%4)&255,d+=String.fromCharCode(c);return d}function k(a){var b={outputUpper:!1,b64Pad:"="};try{a.hasOwnProperty("outputUpper")&&(b.outputUpper=a.outputUpper),a.hasOwnProperty("b64Pad")&&(b.b64Pad=a.b64Pad)}catch(c){}if("boolean"!=typeof b.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof b.b64Pad)throw"Invalid b64Pad formatting option";return b}function l(a,b){var d=null,d=new c(a.a,a.b);return d=32>=b?new c(d.a>>>b|d.b<<32-b&4294967295,d.b>>>b|d.a<<32-b&4294967295):new c(d.b>>>b-32|d.a<<64-b&4294967295,d.a>>>b-32|d.b<<64-b&4294967295)}function m(a,b){var d=null;return d=32>=b?new c(a.a>>>b,a.b>>>b|a.a<<32-b&4294967295):new c(0,a.a>>>b-32)}function n(a,b,d){return new c(a.a&b.a^~a.a&d.a,a.b&b.b^~a.b&d.b)}function o(a,b,d){return new c(a.a&b.a^a.a&d.a^b.a&d.a,a.b&b.b^a.b&d.b^b.b&d.b)}function p(a){var b=l(a,28),d=l(a,34);return a=l(a,39),new c(b.a^d.a^a.a,b.b^d.b^a.b)}function q(a){var b=l(a,14),d=l(a,18);return a=l(a,41),new c(b.a^d.a^a.a,b.b^d.b^a.b)}function r(a){var b=l(a,1),d=l(a,8);return a=m(a,7),new c(b.a^d.a^a.a,b.b^d.b^a.b)}function s(a){var b=l(a,19),d=l(a,61);return a=m(a,6),new c(b.a^d.a^a.a,b.b^d.b^a.b)}function t(a,b){var d,e,f;return d=(65535&a.b)+(65535&b.b),e=(a.b>>>16)+(b.b>>>16)+(d>>>16),f=(65535&e)<<16|65535&d,d=(65535&a.a)+(65535&b.a)+(e>>>16),e=(a.a>>>16)+(b.a>>>16)+(d>>>16),new c((65535&e)<<16|65535&d,f)}function u(a,b,d,e){var f,g,h;return f=(65535&a.b)+(65535&b.b)+(65535&d.b)+(65535&e.b),g=(a.b>>>16)+(b.b>>>16)+(d.b>>>16)+(e.b>>>16)+(f>>>16),h=(65535&g)<<16|65535&f,f=(65535&a.a)+(65535&b.a)+(65535&d.a)+(65535&e.a)+(g>>>16),g=(a.a>>>16)+(b.a>>>16)+(d.a>>>16)+(e.a>>>16)+(f>>>16),new c((65535&g)<<16|65535&f,h)}function v(a,b,d,e,f){var g,h,i;return g=(65535&a.b)+(65535&b.b)+(65535&d.b)+(65535&e.b)+(65535&f.b),h=(a.b>>>16)+(b.b>>>16)+(d.b>>>16)+(e.b>>>16)+(f.b>>>16)+(g>>>16),i=(65535&h)<<16|65535&g,g=(65535&a.a)+(65535&b.a)+(65535&d.a)+(65535&e.a)+(65535&f.a)+(h>>>16),h=(a.a>>>16)+(b.a>>>16)+(d.a>>>16)+(e.a>>>16)+(f.a>>>16)+(g>>>16),new c((65535&h)<<16|65535&g,i)}function w(a,b,d){var e,f,g,h,i,j,k,l,m,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=[],O=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(w=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],f=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],"SHA-384"!==d&&"SHA-512"!==d)throw"Unexpected error in SHA-2 implementation";for(x=80,e=(b+128>>>10<<5)+31,A=32,B=2,L=c,C=t,D=u,E=v,F=r,G=s,H=p,I=q,K=o,J=n,O=[new L(O[0],3609767458),new L(O[1],602891725),new L(O[2],3964484399),new L(O[3],2173295548),new L(O[4],4081628472),new L(O[5],3053834265),new L(O[6],2937671579),new L(O[7],3664609560),new L(O[8],2734883394),new L(O[9],1164996542),new L(O[10],1323610764),new L(O[11],3590304994),new L(O[12],4068182383),new L(O[13],991336113),new L(O[14],633803317),new L(O[15],3479774868),new L(O[16],2666613458),new L(O[17],944711139),new L(O[18],2341262773),new L(O[19],2007800933),new L(O[20],1495990901),new L(O[21],1856431235),new L(O[22],3175218132),new L(O[23],2198950837),new L(O[24],3999719339),new L(O[25],766784016),new L(O[26],2566594879),new L(O[27],3203337956),new L(O[28],1034457026),new L(O[29],2466948901),new L(O[30],3758326383),new L(O[31],168717936),new L(O[32],1188179964),new L(O[33],1546045734),new L(O[34],1522805485),new L(O[35],2643833823),new L(O[36],2343527390),new L(O[37],1014477480),new L(O[38],1206759142),new L(O[39],344077627),new L(O[40],1290863460),new L(O[41],3158454273),new L(O[42],3505952657),new L(O[43],106217008),new L(O[44],3606008344),new L(O[45],1432725776),new L(O[46],1467031594),new L(O[47],851169720),new L(O[48],3100823752),new L(O[49],1363258195),new L(O[50],3750685593),new L(O[51],3785050280),new L(O[52],3318307427),new L(O[53],3812723403),new L(O[54],2003034995),new L(O[55],3602036899),new L(O[56],1575990012),new L(O[57],1125592928),new L(O[58],2716904306),new L(O[59],442776044),new L(O[60],593698344),new L(O[61],3733110249),new L(O[62],2999351573),new L(O[63],3815920427),new L(3391569614,3928383900),new L(3515267271,566280711),new L(3940187606,3454069534),new L(4118630271,4000239992),new L(116418474,1914138554),new L(174292421,2731055270),new L(289380356,3203993006),new L(460393269,320620315),new L(685471733,587496836),new L(852142971,1086792851),new L(1017036298,365543100),new L(1126000580,2618297676),new L(1288033470,3409855158),new L(1501505948,4234509866),new L(1607167915,987167468),new L(1816402316,1246189591)],w="SHA-384"===d?[new L(3418070365,w[0]),new L(1654270250,w[1]),new L(2438529370,w[2]),new L(355462360,w[3]),new L(1731405415,w[4]),new L(41048885895,w[5]),new L(3675008525,w[6]),new L(1203062813,w[7])]:[new L(f[0],4089235720),new L(f[1],2227873595),new L(f[2],4271175723),new L(f[3],1595750129),new L(f[4],2917565137),new L(f[5],725511199),new L(f[6],4215389547),new L(f[7],327033209)];a.length<=e;)a.push(0);for(a[b>>>5]|=128<<24-b%32,a[e]=b,M=a.length,y=0;M>y;y+=A){for(b=w[0],e=w[1],f=w[2],g=w[3],h=w[4],i=w[5],j=w[6],k=w[7],z=0;x>z;z+=1)16>z?(m=z*B+y,l=a.length<=m?0:a[m],m=a.length<=m+1?0:a[m+1],N[z]=new L(l,m)):N[z]=D(G(N[z-2]),N[z-7],F(N[z-15]),N[z-16]),l=E(k,I(h),J(h,i,j),O[z],N[z]),m=C(H(b),K(b,e,f)),k=j,j=i,i=h,h=C(g,l),g=f,f=e,e=b,b=C(l,m);w[0]=C(b,w[0]),w[1]=C(e,w[1]),w[2]=C(f,w[2]),w[3]=C(g,w[3]),w[4]=C(h,w[4]),w[5]=C(i,w[5]),w[6]=C(j,w[6]),w[7]=C(k,w[7])}if("SHA-384"===d)a=[w[0].a,w[0].b,w[1].a,w[1].b,w[2].a,w[2].b,w[3].a,w[3].b,w[4].a,w[4].b,w[5].a,w[5].b];else{if("SHA-512"!==d)throw"Unexpected error in SHA-2 implementation";a=[w[0].a,w[0].b,w[1].a,w[1].b,w[2].a,w[2].b,w[3].a,w[3].b,w[4].a,w[4].b,w[5].a,w[5].b,w[6].a,w[6].b,w[7].a,w[7].b]}return a}"function"==typeof define&&define.amd?define(function(){return b}):"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?module.exports=exports=b:exports=b:a.jsSHA=b}(this),function(){var a,b=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},c={}.hasOwnProperty;a=function(a){var b,c,d,e,f;if("undefined"!=typeof module&&null!==module&&null!=module.exports)f=require("request"),b=require("btoa"),e=require("../lib/jsSHA/src/sha512"),c=require("faye"),module.exports=a(!1,f,e,b,c);else{if(!("undefined"!=typeof $&&null!==$||"undefined"!=typeof d&&null!==d))throw"FirstRally api requires jQuery.";d=$||d,f=function(a,b){var c,e;return null==b&&(b=function(){}),a.type=a.method,a.data=a.body,a.processData=!1,e=function(a,c,d){return b(null,{statusCode:d.status},d.responseText)},c=function(a){return b(null,{statusCode:a.status},a.responseText)},d.ajax(a).then(e,c)},this.FirstRally=a(!0,f,e,b)}},a.call(this,function(a,c,d,e,f){var g,h;return g=function(){function b(){}return b.path_prefix="",b.config={host:"bitcoinindex.es",scheme:"https",api_key:"",api_key_secret:"",version:"0.1"},b.inBrowser=a,b.set=function(a){var b,c;c=[];for(b in a)c.push(this.config[b]=a[b]);return c},b.path=function(a){return"/api/v"+this.config.version+this.path_prefix+a},b.url=function(a){return this.config.scheme+"://"+this.config.host+this.path(a)},b.get=function(a,b){return this.make_request(a,"GET",null,b)},b.post=function(a,b,c){return this.make_request(a,"POST",b,c)},b["delete"]=function(a,b){return this.make_request(a,"DELETE",null,b)},b.make_request=function(a,b,f,g){var i,j,k,l,m,n;return null==g&&(g=function(){}),k=this.path(a),j={url:this.url(a),headers:{},method:b},null!=f&&(j.body=JSON.stringify(f),j.headers["Content-Type"]="application/json"),""!==this.config.api_key&&""!==this.config.api_key_secret&&(m=new d(k,"TEXT"),n=m.getHMAC(this.config.api_key_secret,"TEXT","SHA-512","B64"),i=e(this.config.api_key+":"+n),j.headers.Authorization="Basic "+i),g.length<=1?(l=c(j),g(l)):c(j,function(a,b,c){var d;if(b.statusCode>=400&&b.statusCode<500){if(null==a){try{d=JSON.parse(c)}catch(e){return void g(c,c)}a=new h.Error(b.statusCode,d)}}else try{c=JSON.parse(c)}catch(e){}return g(a,c)})},b}(),h=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.Error=function(a){function c(a,b){var c,d,e,f,g;for(this.statusCode=a,this.original=b,f="",g=this.original,d=0,e=g.length;e>d;d++)c=g[d],0!==f.length&&(f+=" "),f+=c.message+".";this.message=f,this.name="FirstRally.Error"}return b(c,a),c}(Error),d.Conversion=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.path_prefix="/conversions",c.current=function(a,b,c){var d;return"function"==typeof a&&(c=a,a=null,b=null),"function"==typeof b&&(c=b,b=null),null!=a&&(a="/"+a),b=null!=b?"/"+b:"",d=null!=a?(""+a+b).toLowerCase():".json",console.log("---------"+d),this.get(d,c)},c}(g),d.User=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.path_prefix="/user",c.update_profile=function(a,b){return this.post("/profile",a,b)},c.change_password=function(a,b,c){return this.post("/password",{new_password:a,current_password:b},c)},c.login=function(a,b,c){return this.post(login,{email:a,password:b},c)},c}(g),d.Notification=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.path_prefix="/notification",c.create=function(a,b,c,d){return this.post("/new",{stream_id:a,price:b,direction:c},d)},c["delete"]=function(a){return this["delete"]("/"+a,done)},c}(g),d.DataBatch=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.path_prefix="/data_batch",c.create=function(a,b,c,d){return this.post("/new",{exchange_identifier:a,start_date:b.getTime(),end_date:c.getTime()},d)},c.status=function(a,b){return this.get("/"+a,b)},c}(g),d.BatchFile=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.path_prefix="/batch_file",d.download=function(b,c){var d;return d="/"+b+"/download",a?window.open(this.url(d)):this.get(d,c)},d}(g),d.DataStream=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.path_prefix="/data_stream",c.rtc_url="https://rtc.bitcoinindex.es/connect",c.list=function(a){return this.get("/list",a)},c.subscribe=function(a,b){var c;if(null==b&&(b={}),null==f)throw new Error("DataStreams::subscribe() should only be used within a server environment!");return null==this.client&&(this.subscriptions={},this.client=new f.Client(this.rtc_url),c={outgoing:function(a){return function(b,c){return null==b.ext&&(b.ext={}),b.ext.api_key=a.config.api_key,b.ext.api_key_secret=a.config.api_key_secret,c(b)}}(this)},this.client.addExtension(c)),this.subscriptions[a]=this.client.subscribe("/"+a,function(){return function(a){return null!=b.message?b.message(a):void 0}}(this)),this.subscriptions[a].then(function(){return function(){return null!=b.subscribe?b.subscribe():void 0}}(this))},c.unsubscribe=function(a){return null!=this.client&&null!=this.subscriptions&&null!=this.subscriptions[a]?(this.subscriptions[a].cancel(),delete this.subscriptions[a]):void 0},c}(g),d}(g)})}.call(this);